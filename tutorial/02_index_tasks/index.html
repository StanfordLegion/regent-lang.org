<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    

    <title>Index Tasks | Regent</title>
    
    <meta name="author" content="Stanford University">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>
  <body>

    <header class="navbar navbar-static-top rg-nav" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".rg-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Regent</a>
    </div>
    <nav class="collapse navbar-collapse rg-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        
          
            
            
            
            <li class="">
              <a href="/install">Install</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/tutorial">Tutorial</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/reference">Reference</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/resources">Resources</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/publications">Publications</a>
            </li>
            
          
        
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </nav>
  </div>
</header>


    <div class="container with-img-responsive">
  <div class="row">
    <div class="col-md-12">

      
        <h1 class="page-header">
          
            Index Tasks

          
          
        </h1>
      

      <p>Regent provides a number of optimizations to ensure that tasks execute in parallel and with maximum efficiency. One of the most important of these is the <em>index launch</em> optimization. An index launch encapsulates a parallel loop and ensures that Regent is able to amortize the cost of analyzing the enclosed tasks. This is an important optimization that is used in nearly all production codes, and is critical for scaling most Regent programs to large numbers of nodes.</p>
<p>As with nearly all of Regent’s optimizations, this is applied automatically to Regent programs. Any loop that matches Regent’s criteria will be converted into an index launch, without any specific action by the user. However, it is still helpful for users to be aware of when their programs are being optimized, and what types of programs can generally be expected to work well in Regent. Regent also provides a feature, described below, to ensure that loops are being optimized the way that the user expects.</p>
<h2 id="optimizing-index-launches">Optimizing Index Launches</h2>
<p>Recall that tasks execute in parallel only if they do not interfere. Regent must expend effort analyzing each task to determine non-interference with respect to the other children of the same parent task. The index launch optimization amortizes this analysis over a loop of task calls, increasing efficiency when the number of tasks is large.</p>
<p>The following code calls a task <code>double_of</code> in a loop, and accumulates the results into the variable <code>total</code>. This loop will be index launched by Regent.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">__demand</span><span class="p">(</span><span class="n">__index_launch</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_points</span> <span class="k">do</span>
  <span class="n">total</span> <span class="o">+=</span> <span class="n">double_of</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">end</span></code></pre>
</figure>
<p>The annotation <code>__demand(__index_launch)</code> ensures that Regent performs the index launch as expected. Note that this is primarily a <a href="https://en.wikipedia.org/wiki/Defensive_programming">defensive programming</a> feature. Regent will optimize this code, regardless of whether the user adds the annotation or not. The effect of the annotation is not to “force” Regent to optimize the code (Regent will refuse to do so if it is not safe), but instead to produce an error if the optimization is not performed. This can help, especially in large codebases, to ensure that important parts of the program are not deoptimized unexpectedly. It is considered good code hygiene to mark loops with <code>__demand(__index_launch)</code> because it helps users confirm their understanding of how the code will behave. This also helps to improve the error messages generated by Regent, as the compiler can point to specifically those parts of the program (if any) that inhibited optimization.</p>
<p>(This style of annotation is in particular contrast to an OpenMP-style <code>#pragma</code>, which applies the optimization even if it is unsound.)</p>
<h2 id="final-code">Final Code</h2>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">import</span> <span class="s2">"regent"</span>

<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="n">regentlib</span><span class="p">.</span><span class="n">c</span>

<span class="k">task</span> <span class="nf">double_of</span><span class="p">(</span><span class="n">i</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span>
  <span class="n">c</span><span class="p">.</span><span class="n">printf</span><span class="p">(</span><span class="s2">"Hello world from task %d!\n"</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">main</span><span class="p">()</span>
  <span class="kd">var</span> <span class="n">num_points</span> <span class="o">=</span> <span class="mi">4</span>

  <span class="kd">var</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">__demand</span><span class="p">(</span><span class="n">__index_launch</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_points</span> <span class="k">do</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">double_of</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">10</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">regentlib</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">total</span> <span class="o">==</span> <span class="mi">92</span><span class="p">,</span> <span class="s2">"check failed"</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">regentlib</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">main</span><span class="p">)</span></code></pre>
</figure>

    </div>
  </div>
</div>


    <footer class="rg-footer" role="contentinfo">
  <div class="container">
    <p>&copy; 2022 Stanford University.</p>
    <p>Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://getbootstrap.com/">Bootstrap</a>.</p>

    <ul class="rg-footer-links muted">
      <li><a href="/">Home</a></li>
      <li>&middot;</li>
      
        
          <li><a href="/install">Install</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/tutorial">Tutorial</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/reference">Reference</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/resources">Resources</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/publications">Publications</a></li>
          <li>&middot;</li>
        
      
      <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
      <li>&middot;</li>
      <li><a href="/about">About</a></li>
    </ul>
  </div>
</footer>


    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71475406-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
