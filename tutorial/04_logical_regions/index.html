<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    

    <title>Logical Regions | Regent</title>
    
    <meta name="author" content="Stanford University">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>
  <body>

    <header class="navbar navbar-static-top rg-nav" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".rg-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Regent</a>
    </div>
    <nav class="collapse navbar-collapse rg-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        
          
            
            
            
            <li class="">
              <a href="/install">Install</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/tutorial">Tutorial</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/reference">Reference</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/resources">Resources</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/publications">Publications</a>
            </li>
            
          
        
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </nav>
  </div>
</header>


    <div class="container with-img-responsive">
  <div class="row">
    <div class="col-md-12">

      
        <h1 class="page-header">
          
            Logical Regions

          
          
        </h1>
      

      <p>We now come to one of the central abstractions for data in Regent, <em>logical regions</em> (or just “regions” for short). As hinted in earlier tutorials, regions allow mutable data to be used (safely) within Regent. Idiomatic Regent programs usually store most or all of their data in regions.</p>
<p>At their most basic, regions are like arrays of structs in a language like C. The main differences are that regions are not fixed to a single memory allocation, but can seamlessly move around a distributed machine, be copied down to the GPU, etc. In most cases, this happens without any specific user intervention, and users need only be concerned with what data is placed in regions and how that data is used.</p>
<p>Regions consist of a <em>field space</em> (like a C struct) and an <em>index space</em>. The latter doesn’t have a first-class analog in C, but is conceptually the set of indices used to refer to elements within a region (like indices in an array). Each of these components is described in more detail below.</p>
<h2 id="field-spaces">Field Spaces</h2>
<p>A field space (fspace) works much like a struct in C. The following code declares a field space with four fields:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">fspace</span> <span class="nf">fs</span> <span class="p">{</span>
  <span class="n">a</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
  <span class="n">b</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span>
  <span class="n">c</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span>
  <span class="n">d</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span>
<span class="p">}</span></code></pre>
</figure>
<p>As a convenience, multiple, consecutive fields with the same type may be collapsed into a single line. The code below is identical to the version above:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">fspace</span> <span class="nf">fs</span> <span class="p">{</span>
  <span class="n">a</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
  <span class="p">{</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">}</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="c1">-- Multiple fields may be declared with a single type.</span>
<span class="p">}</span></code></pre>
</figure>
<p>In Regent code, <code>fs</code> names a type (the type of the field space), and can be instantiated to create values of this type. For example, the following code defines a variable <code>x</code> of type <code>fs</code>:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">x</span> <span class="o">=</span> <span class="n">fs</span> <span class="p">{</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">6</span> <span class="p">}</span></code></pre>
</figure>
<p>Such values can be used like values of any other type: they can be passed (by-value) to tasks, returned from tasks, modified, etc. To access the individual elements of a field space, use the <code>.</code> (dot) operator.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">sum_fs</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">fs</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="p">.</span><span class="n">a</span> <span class="o">+</span> <span class="n">x</span><span class="p">.</span><span class="n">b</span> <span class="o">+</span> <span class="n">x</span><span class="p">.</span><span class="n">c</span> <span class="o">+</span> <span class="n">x</span><span class="p">.</span><span class="n">d</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">update_fs</span><span class="p">(</span><span class="n">x</span> <span class="p">:</span> <span class="n">fs</span><span class="p">)</span>
  <span class="kd">var</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span>
  <span class="n">y</span><span class="p">.</span><span class="n">a</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">.</span><span class="mi">25</span>
  <span class="n">y</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">y</span><span class="p">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">y</span><span class="p">.</span><span class="n">d</span>
  <span class="k">return</span> <span class="n">y</span>
<span class="k">end</span></code></pre>
</figure>
<p>There is also a syntax to unpack multiple values of a field space at the same time. The example below creates 4 new variables, <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> with the values of <code>x.a</code>, <code>x.b</code>, <code>x.c</code>, and <code>x.d</code>.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="p">{</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">}</span> <span class="o">=</span> <span class="n">x</span> <span class="c1">-- where x is of type fs</span></code></pre>
</figure>
<p>This syntax also supports creating variables with different names, if that is desired. In the code below, <code>x_a</code> and so on name the new variables, <code>a</code> etc. name the fields of the field space to be unpacked.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="p">{</span><span class="n">x_a</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">x_b</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">x_c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">x_d</span> <span class="o">=</span> <span class="n">d</span><span class="p">}</span> <span class="o">=</span> <span class="n">x</span> <span class="c1">-- where x is of type fs</span></code></pre>
</figure>
<h2 id="index-spaces">Index Spaces</h2>
<p>An index space (ispace) is a collection of index points. This is most directly analogous to the set of valid array indices for an array in C. While the latter is not a first-class feature of C, index spaces are first-class objects in Regent and can be created dynamically, passed to tasks and returned from tasks.</p>
<p>The example below creates a 1-D index space with 1024 elements. This would be similar to <code>int[1024]</code> in C, except an index space refers to the set of valid indices only and contains no actual data.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span></code></pre>
</figure>
<p>Index spaces can be passed to and returned from tasks:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">take_is</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">))</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">make_is</span><span class="p">(</span><span class="n">n</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span>
  <span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">is</span>
<span class="k">end</span></code></pre>
</figure>
<p>Index spaces can also be iterated. The code below executes 1024 iterations, for the values <code>0</code> through <code>1023</code>.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
  <span class="c1">-- x takes the values 0, ... 1023</span>
<span class="k">end</span></code></pre>
</figure>
<h3 id="index-space-bounds">Index Space Bounds</h3>
<p>One notable difference between index spaces and C arrays is that index spaces need not start at 0. The following index space contains the elements, <code>-1</code>, <code>0</code>, <code>1</code>, … <code>10</code>.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span></code></pre>
</figure>
<p>In its most general form, the arguments to the <code>ispace</code> operator are as follows:</p>
<ol type="1">
<li><p>The type of the index (e.g., <code>int1d</code>).</p></li>
<li><p>The extent (size) of the index space (e.g., <code>12</code> indicates it contains 12 elements).</p></li>
<li><p>The offset (start) of the index space (e.g., <code>-1</code> indicates the first element starts at index −1).</p></li>
</ol>
<p>Index spaces support two operators, <code>.bounds</code> and <code>.volume</code>, to retrieve the bounding rectangle and volume of the index space, respectively.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="n">is</span><span class="p">.</span><span class="n">bounds</span> <span class="c1">-- returns rect1d { lo = int1d(-1), hi = int1d(10) }</span>
<span class="n">is</span><span class="p">.</span><span class="n">volume</span> <span class="c1">-- returns 12</span></code></pre>
</figure>
<h3 id="multi-dimensional-index-spaces">Multi-dimensional Index Spaces</h3>
<p>Index spaces are not restricted to 1 dimension. Regent supports up to 9 dimensions, though for dimensions above 3, Regent must be recompiled with the appropriate support (set <code>MAX_DIM=N</code> when building). Regent provides a set of built-in index types for each of these dimensions: <code>int1d</code>, <code>int2d</code>, <code>int3d</code>, etc. up to <code>int9d</code> (if compiled with the right support).</p>
<p><code>int1d</code> is a special case in that it corresponds directly into an <code>int</code>. For the other cases, each <code>intNd</code> is actually a field space with <code>N</code> fields. These fields always take the following ordering: <code>x</code>, <code>y</code>, <code>z</code>, <code>w</code>, <code>v</code>, <code>u</code>, <code>t</code>, <code>s</code>, <code>r</code>.</p>
<p>Because <code>intNd</code> types are field spaces, their elements can be accessed with the usual field space syntax.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">sum_coordinates</span><span class="p">(</span><span class="n">i</span> <span class="p">:</span> <span class="kt">int4d</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">i</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">z</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="n">w</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">make_coordinate</span><span class="p">(</span><span class="n">a</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">b</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">c</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">d</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span>
  <span class="c1">-- field names are matched positionally when unspecified</span>
  <span class="k">return</span> <span class="kt">int4d</span> <span class="p">{</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="p">}</span>
<span class="k">end</span></code></pre>
</figure>
<p>Multi-dimensional index spaces can be created from multi-dimensional index types. In this case, the extent specifies the upper-rectangular corner of a bounding box, and the offset shifts the box by the specified amount. The offset is zero by default. Some examples are shown below:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is1</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="c1">-- [0, 1, ... 9]</span>
<span class="kd">var</span> <span class="n">is2</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int2d</span><span class="p">,</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">})</span> <span class="c1">-- [{0, 0}, {0, 1}, ... {0, 3}, ... {3, 3}]</span>
<span class="kd">var</span> <span class="n">is3</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int3d</span><span class="p">,</span> <span class="p">{</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">},</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">})</span> <span class="c1">-- [{1, 2, 3}, ... {5, 6, 7}]</span></code></pre>
</figure>
<h3 id="unstructured-index-spaces">“Unstructured” Index Spaces</h3>
<p>For historical reasons, Regent supports a notion of an “unstructured” index space via the index type <code>ptr</code>. It is functionally equivalent to <code>int1d</code> in all respects and is being maintained for backwards compatibility only. Most programs can use <code>int1d</code> instead with no negative consequences.</p>
<h3 id="sparse-index-spaces">Sparse Index Spaces</h3>
<p>In general, index spaces need not be dense rectangles. Regent does not provide a syntax to directly create a sparse index space, but they can be created via partitioning, a feature discussed in a later tutorial.</p>
<h2 id="regions">Regions</h2>
<p>Regions take a field space and an index space and put them together to get a data structure that is similar to an array in C. Here’s an example, using the <code>fs</code> field space from earlier:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">r</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">fs</span><span class="p">)</span></code></pre>
</figure>
<p>This region contains elements numbered <code>0</code> to <code>9</code> (inclusive), and each element contains fields <code>a</code>, <code>b</code>, <code>c</code> and <code>d</code>.</p>
<p>The index space may either be specified inline (as above) or out-of-line. The latter allows multiple regions to be created with the same index space (and the same or different field space).</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="kd">var</span> <span class="n">s</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="kd">var</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="kd">var</span> <span class="n">u</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span></code></pre>
</figure>
<h3 id="region-iteration-and-access">Region Iteration and Access</h3>
<p>Like index spaces, regions can be iterated. One difference is that when regions are iterated, the iteration ranges over pointers to the elements of the region. The <code>@</code> (dereference) operator may be used on pointers to access (read or write) the corresponding region element. In the following loop, each element of the region <code>i</code> is assigned the value <code>i+1</code>.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">r</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="kt">int</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">r</span> <span class="k">do</span>
  <span class="o">@</span><span class="n">x</span> <span class="o">=</span> <span class="kt">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="k">end</span></code></pre>
</figure>
<p>In the case where the region’s field space is not a primitive type (i.e., not <code>int</code>, <code>double</code>, <code>float</code>, etc.), the <code>.</code> (dot) operator can be used to implicitly dereference a pointer. Below, <code>x.a</code> is equivalent to writing <code>(@x).a</code>.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">r</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">fs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">r</span> <span class="k">do</span>
  <span class="n">x</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14</span>
  <span class="n">x</span><span class="p">.</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">x</span><span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">b</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">x</span><span class="p">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">c</span> <span class="o">*</span> <span class="n">x</span><span class="p">.</span><span class="n">c</span>
<span class="k">end</span></code></pre>
</figure>
<h3 id="array-syntax-for-region-access">Array Syntax for Region Access</h3>
<p>In addition to the pointer-style syntax shown above, regions also support an array-style syntax (<code>r[...]</code>). The example below is identical to the previous example.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">r</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">fs</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="n">r</span> <span class="k">do</span>
  <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">.</span><span class="mi">14</span>
  <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">b</span> <span class="o">=</span> <span class="mi">2</span>
  <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">c</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">b</span> <span class="o">+</span> <span class="kt">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">d</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">c</span> <span class="o">*</span> <span class="n">r</span><span class="p">[</span><span class="n">x</span><span class="p">].</span><span class="n">c</span>
<span class="k">end</span></code></pre>
</figure>
<p>This form can be particularly helpful when it may not be obvious what region an index is contained in (e.g., when doing index arithmetic on the pointers).</p>
<h3 id="region-typing-and-assignment">Region Typing and Assignment</h3>
<p>Unlike other types, region variables in Regent <em>cannot</em> be assigned a new value. This is a type error. Every region created in a region program is given a unique type, and even if it seems compatible, cannot be mixed with any other region in the program.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="kd">var</span> <span class="n">s</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="kd">var</span> <span class="n">t</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">t</span> <span class="c1">-- ERROR: type mismatch between region(...) and region(...)</span></code></pre>
</figure>
<p>These error messages can sometimes be confusing to read. To help disambiguate the regions in an error message, use the <code>-fdebug 1</code> flag. With the example above, this would produce something like:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="n">s</span> <span class="o">=</span> <span class="n">t</span> <span class="c1">-- ERROR: type mismatch between region#1(...) and region#2(...)</span></code></pre>
</figure>
<h3 id="region-arguments">Region Arguments</h3>
<p>Despite the restrictions on region assignment, regions <em>can</em> be passed to tasks. For example, the task:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">take_region</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span> <span class="n">fs</span><span class="p">))</span>
<span class="k">end</span></code></pre>
</figure>
<p>Can be called as:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">s</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">fs</span><span class="p">)</span>
<span class="n">take_region</span><span class="p">(</span><span class="n">s</span><span class="p">)</span></code></pre>
</figure>
<p>At the point where <code>take_region</code> is called, <code>s</code> is matched to <code>r</code>. Even though they have different types, they are still compatible, and the call is valid.</p>
<p>Note that regions <em>do</em> allow mutation through task arguments (in fact, they are the only type in Regent that permits this). However, in order to do this, tasks must explicitly declare the privileges (<code>reads</code>, <code>writes</code>, etc.) they intend to use for their region arguments. As written, <code>task_region</code> declares no privileges on <code>r</code> and thus would be unable to either read or write its contents. Privileges and region access are discussed in a future tutorial.</p>
<h2 id="final-code">Final Code</h2>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">import</span> <span class="s2">"regent"</span>

<span class="k">fspace</span> <span class="nf">fs</span> <span class="p">{</span>
  <span class="n">a</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
  <span class="p">{</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">}</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">task</span> <span class="nf">make_fs</span><span class="p">(</span><span class="n">w</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span> <span class="n">x</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">y</span> <span class="p">:</span> <span class="kt">int</span><span class="p">,</span> <span class="n">z</span> <span class="p">:</span> <span class="kt">int</span><span class="p">)</span> <span class="p">:</span> <span class="n">fs</span>
  <span class="kd">var</span> <span class="n">obj</span> <span class="o">=</span> <span class="n">fs</span> <span class="p">{</span> <span class="n">a</span> <span class="o">=</span> <span class="n">w</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">z</span> <span class="p">}</span>
  <span class="k">return</span> <span class="n">obj</span>
<span class="k">end</span>

<span class="k">fspace</span> <span class="nf">point</span> <span class="p">{</span>
  <span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">}</span> <span class="p">:</span> <span class="kt">double</span>
<span class="p">}</span>

<span class="k">fspace</span> <span class="nf">edge</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">point</span><span class="p">))</span> <span class="p">{</span>
 <span class="n">left</span><span class="p">:</span> <span class="kt">ptr</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>
 <span class="n">right</span><span class="p">:</span> <span class="kt">ptr</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">r</span><span class="p">),</span>
<span class="p">}</span>

<span class="k">task</span> <span class="nf">make_edge</span><span class="p">(</span><span class="n">points</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">point</span><span class="p">),</span> <span class="n">a</span> <span class="p">:</span> <span class="kt">ptr</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">),</span> <span class="n">b</span> <span class="p">:</span> <span class="kt">ptr</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">points</span><span class="p">))</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">edge</span><span class="p">(</span><span class="n">points</span><span class="p">)]</span> <span class="p">{</span> <span class="n">left</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">b</span> <span class="p">}</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">main</span><span class="p">()</span>
  <span class="kd">var</span> <span class="n">unstructured_is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">ptr</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span>

  <span class="kd">var</span> <span class="n">structured_is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

  <span class="kd">var</span> <span class="n">unstructured_lr</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">unstructured_is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
  <span class="kd">var</span> <span class="n">structured_lr</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">structured_is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>

  <span class="kd">var</span> <span class="n">no_clone_lr</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">structured_is</span><span class="p">,</span> <span class="n">fs</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">regentlib</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">main</span><span class="p">)</span></code></pre>
</figure>
<h2 id="next-up">Next Up</h2>
<p>Continue to the <a href="/tutorial/05_physical_regions">next tutorial</a> to learn more about the mapping of regions to physical memory allocations in Regent.</p>

    </div>
  </div>
</div>


    <footer class="rg-footer" role="contentinfo">
  <div class="container">
    <p>&copy; 2023 Stanford University.</p>
    <p>Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://getbootstrap.com/">Bootstrap</a>.</p>

    <ul class="rg-footer-links muted">
      <li><a href="/">Home</a></li>
      <li>&middot;</li>
      
        
          <li><a href="/install">Install</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/tutorial">Tutorial</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/reference">Reference</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/resources">Resources</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/publications">Publications</a></li>
          <li>&middot;</li>
        
      
      <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
      <li>&middot;</li>
      <li><a href="/about">About</a></li>
    </ul>
  </div>
</footer>


    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71475406-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
