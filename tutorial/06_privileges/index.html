<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    

    <title>Privileges | Regent</title>
    
    <meta name="author" content="Stanford University">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/syntax.css" rel="stylesheet" type="text/css" media="all">

    <!-- Fav and touch icons -->
    <!-- Update these with your own images
      <link rel="shortcut icon" href="images/favicon.ico">
      <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
      <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
      <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->
  </head>
  <body>

    <header class="navbar navbar-static-top rg-nav" id="top" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".rg-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">Regent</a>
    </div>
    <nav class="collapse navbar-collapse rg-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        
          
            
            
            
            <li class="">
              <a href="/install">Install</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/tutorial">Tutorial</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/reference">Reference</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/resources">Resources</a>
            </li>
            
          
        
          
            
            
            
            <li class="">
              <a href="/publications">Publications</a>
            </li>
            
          
        
      </ul>

      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
        <li><a href="/about">About</a></li>
      </ul>
    </nav>
  </div>
</header>


    <div class="container with-img-responsive">
  <div class="row">
    <div class="col-md-12">

      
        <h1 class="page-header">
          
            Privileges

          
          
        </h1>
      

      <p><em>Privileges</em> describe the ways in which tasks interact with their region arguments. This is one of the key cornerstones of the Regent programming model: privileges allow Regent to determine what a task will do (to its region arguments) without actually running the task. Privileges, in combination with the region arguments used, are the way that Regent determines what tasks may run in parallel.</p>
<h2 id="privileges">Privileges</h2>
<p>Regent supports the following privileges:</p>
<ul>
<li><code>reads</code></li>
<li><code>writes</code></li>
<li><code>reduces</code> with one of the following operators: <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>min</code> or <code>max</code></li>
</ul>
<p>Each privilege corresponds to an operation that a task is permitted to perform on a region.</p>
<p>The <code>reads</code> privilege allows a task to read the contents of a region:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="kd">var</span> <span class="n">_</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="o">...</span><span class="p">]</span></code></pre>
</figure>
<p>The <code>writes</code> privilege allows a task to write to a region:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="n">r</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="o">...</span></code></pre>
</figure>
<p>The <code>reduces</code> privilege allows a task to apply the corresponding reduction operator. For example, <code>+</code>:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="n">r</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="o">+=</span> <span class="o">...</span></code></pre>
</figure>
<p>Or <code>min</code>:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="n">r</span><span class="p">[</span><span class="o">...</span><span class="p">]</span> <span class="n">min</span><span class="o">=</span> <span class="o">...</span></code></pre>
</figure>
<p>Privileges can be combined, so <code>reads</code> and <code>writes</code> can be used to provide read-write access to a region. In general, any combination of <code>reads</code> or <code>writes</code> with <code>reduces</code> is upgraded to <code>reads writes</code>, so this is not really a useful combination. Similarly any two reduction operators (e.g., <code>reduces +</code> and <code>reduces *</code>) will be upgraded to <code>reads writes</code>. Reductions are most useful on their own.</p>
<h2 id="declaring-privileges-in-a-task">Declaring Privileges in a Task</h2>
<p>A task can declare privileges in a <code>where</code> clause, following the task arguments. For example, reading a region <code>r</code>:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">read_task</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="k">where</span> <span class="k">reads</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre>
</figure>
<p>Or writing:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">write_task</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="k">where</span> <span class="k">writes</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre>
</figure>
<p>Reading and writing:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">read_write_task</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="k">where</span> <span class="k">reads</span> <span class="k">writes</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre>
</figure>
<p>And reducing:</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">sum_task</span><span class="p">(</span><span class="n">r</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="o">...</span><span class="p">))</span>
<span class="k">where</span> <span class="k">reduces</span> <span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre>
</figure>
<h2 id="field-specific-privileges">Field-Specific Privileges</h2>
<p>Privileges can also be specified on specific fields within a region.</p>
<h2 id="dependence-analysis">Dependence Analysis</h2>
<h2 id="daxpy-with-privileges">DAXPY with Privileges</h2>
<p>Privileges describe how a task interacts with region-typed arguments. For example, <code>reads</code> is required in order to read from a region argument, and <code>writes</code> is required to modify a region.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">daxpy</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
           <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">),</span>
           <span class="n">output_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
           <span class="n">alpha</span> <span class="p">:</span> <span class="kt">double</span><span class="p">)</span>
<span class="c1">-- Multiple privileges may be specified at once. Privileges may also</span>
<span class="c1">-- apply to specific fields. (Multiple fields can be named with braces.)</span>
<span class="k">where</span> <span class="k">reads</span> <span class="k">writes</span><span class="p">(</span><span class="n">output_lr</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="k">reads</span><span class="p">(</span><span class="n">input_lr</span><span class="p">.{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="n">output_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</figure>
<p>Privileges are enforced by the type system, and a compile error will be issued if the declared privileges are violated.</p>
<p>Beyond <code>reads</code> and <code>writes</code>, reductions (<code>+</code>, <code>*</code>, <code>-</code>, <code>/</code>, <code>min</code>, <code>max</code>) allow the application of certain commutative operators to the elements of regions.</p>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">task</span> <span class="nf">sum_output</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
                <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">),</span>
                <span class="n">output_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
                <span class="n">alpha</span> <span class="p">:</span> <span class="kt">double</span><span class="p">)</span>
<span class="k">where</span> <span class="k">reduces</span> <span class="o">+</span><span class="p">(</span><span class="n">output_lr</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="k">reads</span><span class="p">(</span><span class="n">input_lr</span><span class="p">.{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="n">output_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span> <span class="o">+=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">max_output</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
           <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">),</span>
           <span class="n">output_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
           <span class="n">alpha</span> <span class="p">:</span> <span class="kt">double</span><span class="p">)</span>
<span class="k">where</span> <span class="k">reduces</span> <span class="n">max</span><span class="p">(</span><span class="n">output_lr</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="k">reads</span><span class="p">(</span><span class="n">input_lr</span><span class="p">.{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="n">output_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span> <span class="n">max</span><span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>
</figure>
<h2 id="final-code">Final Code</h2>
<figure class="highlight">
<pre><code class="language-regent" data-lang="regent"><span class="k">import</span> <span class="s2">"regent"</span>

<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="n">regentlib</span><span class="p">.</span><span class="n">c</span>

<span class="k">fspace</span> <span class="nf">input</span> <span class="p">{</span>
  <span class="n">x</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
  <span class="n">y</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fspace</span> <span class="nf">output</span> <span class="p">{</span>
  <span class="n">z</span> <span class="p">:</span> <span class="kt">double</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">task</span> <span class="nf">init</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
          <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">))</span>
<span class="k">where</span> <span class="k">writes</span><span class="p">(</span><span class="n">input_lr</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">drand48</span><span class="p">()</span>
    <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">drand48</span><span class="p">()</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">daxpy</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
           <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">),</span>
           <span class="n">output_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
           <span class="n">alpha</span> <span class="p">:</span> <span class="kt">double</span><span class="p">)</span>
<span class="k">where</span> <span class="k">reads</span> <span class="k">writes</span><span class="p">(</span><span class="n">output_lr</span><span class="p">.</span><span class="n">z</span><span class="p">),</span> <span class="k">reads</span><span class="p">(</span><span class="n">input_lr</span><span class="p">.{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">})</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="n">output_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">check</span><span class="p">(</span><span class="n">is</span> <span class="p">:</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">),</span>
           <span class="n">input_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">),</span>
           <span class="n">output_lr</span> <span class="p">:</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">),</span>
           <span class="n">alpha</span> <span class="p">:</span> <span class="kt">double</span><span class="p">)</span>
<span class="k">where</span> <span class="k">reads</span><span class="p">(</span><span class="n">input_lr</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">)</span> <span class="k">do</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">is</span> <span class="k">do</span>
    <span class="kd">var</span> <span class="n">expected</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">+</span> <span class="n">input_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span>
    <span class="kd">var</span> <span class="n">received</span> <span class="o">=</span> <span class="n">output_lr</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">z</span>
    <span class="n">regentlib</span><span class="p">.</span><span class="n">assert</span><span class="p">(</span><span class="n">expected</span> <span class="o">==</span> <span class="n">received</span><span class="p">,</span> <span class="s2">"check failed"</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">task</span> <span class="nf">main</span><span class="p">()</span>
  <span class="kd">var</span> <span class="n">num_elements</span> <span class="o">=</span> <span class="mi">1024</span>
  <span class="kd">var</span> <span class="n">is</span> <span class="o">=</span> <span class="kt">ispace</span><span class="p">(</span><span class="kt">int1d</span><span class="p">,</span> <span class="n">num_elements</span><span class="p">)</span>
  <span class="kd">var</span> <span class="n">input_lr</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span>
  <span class="kd">var</span> <span class="n">output_lr</span> <span class="o">=</span> <span class="kt">region</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

  <span class="n">init</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">)</span>

  <span class="kd">var</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">drand48</span><span class="p">()</span>
  <span class="n">daxpy</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>

  <span class="n">check</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">input_lr</span><span class="p">,</span> <span class="n">output_lr</span><span class="p">,</span> <span class="n">alpha</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">regentlib</span><span class="p">.</span><span class="n">start</span><span class="p">(</span><span class="n">main</span><span class="p">)</span></code></pre>
</figure>

    </div>
  </div>
</div>


    <footer class="rg-footer" role="contentinfo">
  <div class="container">
    <p>&copy; 2022 Stanford University.</p>
    <p>Powered by <a href="http://jekyllrb.com/">Jekyll</a> and <a href="http://getbootstrap.com/">Bootstrap</a>.</p>

    <ul class="rg-footer-links muted">
      <li><a href="/">Home</a></li>
      <li>&middot;</li>
      
        
          <li><a href="/install">Install</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/tutorial">Tutorial</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/reference">Reference</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/resources">Resources</a></li>
          <li>&middot;</li>
        
      
        
          <li><a href="/publications">Publications</a></li>
          <li>&middot;</li>
        
      
      <li><a href="https://github.com/StanfordLegion/legion/tree/master/language">GitHub</a></li>
      <li>&middot;</li>
      <li><a href="/about">About</a></li>
    </ul>
  </div>
</footer>


    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71475406-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
